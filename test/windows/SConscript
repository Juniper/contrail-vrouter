#
# Copyright (c) 2018 Juniper Networks, Inc. All rights reserved.
#

Import('VRouterEnv')
env = VRouterEnv.Clone()

env.Append(CPPPATH = [env['TOP_INCLUDE'], 'include'])

# Treat warnings as errors
env.Append(CPPFLAGS = '/WX')

env.Replace(LIBPATH = env['TOP_LIB'])
env.Append(LIBPATH = ['.', '../../windows'])

# vRouter code
env.Replace(LIBS = ['win_packet'])
# 3rd party libs
env.Append(LIBS = 'cmocka')

env.AppendENVPath('Path', Dir('#build/bin'))

win_packet_clone_tests_src = ['test_win_packet_clone.c', 'fake_win_packet_raw.c']
win_packet_clone_tests = env.UnitTest('win_packet_clone_tests', win_packet_clone_tests_src)

kernel_tests = env.TestSuite('kernel-tests', [win_packet_clone_tests])
env.Requires(kernel_tests, '#build/bin/cmocka.dll')
